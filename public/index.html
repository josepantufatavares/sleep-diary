<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Digital Sleep Diary</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.5.0/Recharts.min.js"></script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: #0f172a; color: #fff; font-family: system-ui, sans-serif; min-height: 100vh; }
  input, select, textarea, button { font-family: inherit; }
  input[type=range] { width: 100%; cursor: pointer; }
  input[type=range].accent-indigo { accent-color: #6366f1; }
  input[type=range].accent-yellow { accent-color: #fbbf24; }
  ::-webkit-scrollbar { width: 4px; height: 4px; }
  ::-webkit-scrollbar-track { background: #1e293b; }
  ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
  .inp { width:100%; background:#1e293b; border:1px solid #475569; border-radius:8px; padding:8px 12px; color:#fff; font-size:0.875rem; outline:none; }
  .inp:focus { border-color:#818cf8; }
  .sel { width:100%; background:#1e293b; border:1px solid #475569; border-radius:8px; padding:8px 12px; color:#fff; font-size:0.875rem; outline:none; }
  .lbl { display:block; color:#cbd5e1; font-size:0.75rem; margin-bottom:4px; font-weight:500; }
  .btn-primary { width:100%; padding:10px; border-radius:12px; font-weight:700; color:#fff; border:none; cursor:pointer; font-size:0.875rem; background:linear-gradient(to right,#4f46e5,#7c3aed); transition:opacity 0.15s; }
  .btn-primary:hover { opacity:0.9; }
  .btn-outline { background:none; border:1px solid #475569; color:#94a3b8; border-radius:8px; padding:4px 12px; font-size:0.75rem; cursor:pointer; transition:color 0.15s; }
  .btn-outline:hover { color:#fff; }
  .tab-btn { flex-shrink:0; padding:12px; font-size:0.75rem; font-weight:500; background:none; border:none; border-bottom:2px solid transparent; cursor:pointer; color:#94a3b8; transition:color 0.15s; }
  .tab-btn.active { color:#818cf8; border-bottom-color:#818cf8; }
  .card { background:#1e293b; border:1px solid #334155; border-radius:12px; padding:16px; }
  .stat-card { background:#1e293b; border:1px solid #334155; border-radius:12px; padding:16px; text-align:center; }
  .mini-card { background:#334155; border-radius:8px; padding:8px; text-align:center; }
  .space-y-2>*+* { margin-top:8px; }
  .space-y-3>*+* { margin-top:12px; }
  .space-y-4>*+* { margin-top:16px; }
  .space-y-5>*+* { margin-top:20px; }
  .grad-header { background:linear-gradient(to right,#1e1b4b,#4c1d95,#0f172a); }
  .grad-admin  { background:linear-gradient(to right,#4a1d96,#1e1b4b,#0f172a); }
  .spinner { border:3px solid #334155; border-top-color:#6366f1; border-radius:50%; width:32px; height:32px; animation:spin 0.7s linear infinite; margin:40px auto; }
  @keyframes spin { to { transform:rotate(360deg); } }
  .footer { text-align:center; padding:16px; color:#475569; font-size:0.7rem; border-top:1px solid #1e293b; margin-top:24px; }
</style>
</head>
<body>
<div id="root"></div>
<script>
const { useState, useEffect, useCallback } = React;
const { BarChart, Bar, LineChart, Line, RadarChart, Radar, PolarGrid, PolarAngleAxis,
        XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

// â”€â”€ API helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API = async (method, path, body, token) => {
  const res = await fetch("/api" + path, {
    method,
    headers: { "Content-Type": "application/json", ...(token ? { Authorization: "Bearer " + token } : {}) },
    body: body ? JSON.stringify(body) : undefined,
  });
  const data = await res.json();
  if (!res.ok) throw new Error(data.error || "Request failed");
  return data;
};

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const fmt = d => new Date(d).toLocaleDateString("en-GB", { weekday:"short", day:"2-digit", month:"short" });
const timeToH = t => { const [h,m] = t.split(":").map(Number); return h + m/60; };
const calcDur = (bed, wake) => { let b=timeToH(bed), w=timeToH(wake); if(w<=b) w+=24; return Math.round((w-b)*10)/10; };
const avg = arr => arr.length ? +(arr.reduce((a,b)=>a+b,0)/arr.length).toFixed(1) : 0;

const SECURITY_QUESTIONS = [
  "What was the name of your first pet?",
  "What is your mother's maiden name?",
  "What city were you born in?",
  "What was the name of your primary school?",
  "What is your favourite book?",
];

const TIPS = [
  { icon:"ðŸ“µ", title:"Limit Screen Time", text:"Avoid screens at least 1 hour before bed. Blue light suppresses melatonin production." },
  { icon:"â°", title:"Consistent Schedule", text:"Go to bed and wake up at the same time every day, even on weekends." },
  { icon:"ðŸŒ¡ï¸", title:"Cool Your Room", text:"Keep your bedroom between 16â€“20Â°C for optimal sleep quality." },
  { icon:"â˜•", title:"Avoid Caffeine", text:"Avoid caffeine after 2 PM. It can stay in your system for up to 6 hours." },
  { icon:"ðŸ§˜", title:"Wind Down", text:"Try reading, stretching, or meditation before bed to signal your brain it's time to sleep." },
  { icon:"ðŸŒ™", title:"Darkness Matters", text:"Use blackout curtains or a sleep mask. Even small amounts of light can disrupt sleep." },
];

const genInsights = entries => {
  if (entries.length < 2) return ["Log at least 2 days to get personalized insights!"];
  const msgs = [];
  const as = avg(entries.map(e=>e.duration));
  const ae = avg(entries.map(e=>e.energy));
  const asc = avg(entries.map(e=>e.screen_time));
  if (as < 7) msgs.push("âš ï¸ Your average sleep is " + as + "h â€” below the recommended 7â€“9 hours.");
  else msgs.push("âœ… Great! Your average sleep of " + as + "h is within healthy range.");
  const low = entries.filter(e=>e.screen_time<=1), high = entries.filter(e=>e.screen_time>1);
  if (low.length && high.length) {
    const eL = avg(low.map(e=>e.energy)), eH = avg(high.map(e=>e.energy));
    if (eL > eH) msgs.push("ðŸ’¡ On days with â‰¤1h screen time, your energy was " + (eL-eH).toFixed(1) + " pts higher!");
  }
  if (asc > 2) msgs.push("ðŸ“± You average " + asc + "h of pre-sleep screen time. Try reducing it.");
  if (ae >= 7) msgs.push("âš¡ Morning energy is strong (avg " + ae + "/10). Keep it up!");
  else if (ae < 5) msgs.push("ðŸ˜´ Morning energy is low (avg " + ae + "/10). Better habits may help.");
  return msgs;
};

// â”€â”€ AuthScreen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AuthScreen({ onLogin }) {
  const [mode, setMode] = useState("login");
  const [form, setForm] = useState({ username:"", password:"", confirm:"", secQ:0, secA:"" });
  const [rec,  setRec]  = useState({ step:1, username:"", question:"", answer:"", newPass:"", confirm:"" });
  const [err,  setErr]  = useState("");
  const [ok,   setOk]   = useState("");
  const [loading, setLoading] = useState(false);
  const sf = (k,v) => setForm(f=>({...f,[k]:v}));
  const sr = (k,v) => setRec(r=>({...r,[k]:v}));

  const handleAuth = async () => {
    setErr(""); setOk(""); setLoading(true);
    try {
      const u = form.username.trim().toLowerCase(), p = form.password;
      if (!u || !p) throw new Error("Please fill all fields.");
      if (mode==="register" && p!==form.confirm) throw new Error("Passwords don't match.");
      if (mode==="register" && !form.secA.trim()) throw new Error("Please provide a security answer.");
      const body = mode==="login"
        ? { username:u, password:p }
        : { username:u, password:p, secQ:+form.secQ, secA:form.secA.trim() };
      const data = await API("POST", mode==="login" ? "/login" : "/register", body);
      localStorage.setItem("sd_token", data.token);
      localStorage.setItem("sd_user", JSON.stringify({ username:data.username, isAdmin:data.isAdmin }));
      onLogin({ username:data.username, isAdmin:data.isAdmin, token:data.token });
    } catch(e) { setErr(e.message); } finally { setLoading(false); }
  };

  const handleRecover = async () => {
    setErr(""); setOk(""); setLoading(true);
    try {
      if (rec.step===1) {
        if (!rec.username.trim()) throw new Error("Enter your username.");
        const data = await API("POST", "/recover/question", { username:rec.username.trim() });
        setRec(r=>({...r, step:2, question:data.question}));
      } else if (rec.step===2) {
        if (!rec.answer.trim()) throw new Error("Please enter your answer.");
        setRec(r=>({...r, step:3}));
      } else {
        if (rec.newPass.length < 4) throw new Error("Min. 4 characters.");
        if (rec.newPass !== rec.confirm) throw new Error("Passwords don't match.");
        await API("POST", "/recover/verify", { username:rec.username.trim(), answer:rec.answer.trim(), newPassword:rec.newPass });
        setOk("Password reset! You can now log in.");
        setTimeout(() => { setMode("login"); setErr(""); setOk(""); setRec({step:1,username:"",question:"",answer:"",newPass:"",confirm:""}); }, 2000);
      }
    } catch(e) { setErr(e.message); } finally { setLoading(false); }
  };

  const E = React.createElement;
  return E("div", { style:{minHeight:"100vh",background:"#0f172a",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"16px"} },
    E("div", { style:{fontSize:"3rem",marginBottom:"8px"} }, "ðŸŒ™"),
    E("h1",  { style:{fontSize:"1.5rem",fontWeight:700,color:"#fff",marginBottom:"4px"} }, "Digital Sleep Diary"),
    E("p",   { style:{color:"#94a3b8",fontSize:"0.875rem",marginBottom:"24px"} }, "Track sleep Â· screen time Â· morning energy"),
    E("div", { className:"card", style:{width:"100%",maxWidth:"384px"} },
      mode!=="recover" && E("div", { style:{display:"flex",borderRadius:"8px",overflow:"hidden",border:"1px solid #475569",marginBottom:"16px"} },
        ["login","register"].map(m => E("button", { key:m, onClick:()=>{setMode(m);setErr("");setOk("");}, style:{flex:1,padding:"8px",fontSize:"0.875rem",fontWeight:500,background:mode===m?"#4f46e5":"none",color:mode===m?"#fff":"#94a3b8",border:"none",cursor:"pointer"} }, m==="login"?"Login":"Register"))
      ),
      mode!=="recover" && E(React.Fragment, null,
        E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Username"), E("input",{className:"inp",placeholder:"your username",value:form.username,onChange:e=>sf("username",e.target.value)})),
        E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Password"), E("input",{type:"password",className:"inp",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",value:form.password,onChange:e=>sf("password",e.target.value)})),
        mode==="register" && E(React.Fragment, null,
          E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Confirm Password"), E("input",{type:"password",className:"inp",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",value:form.confirm,onChange:e=>sf("confirm",e.target.value)})),
          E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Security Question"),
            E("select",{className:"sel",value:form.secQ,onChange:e=>sf("secQ",e.target.value)},
              SECURITY_QUESTIONS.map((q,i)=>E("option",{key:i,value:i},q))
            )
          ),
          E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Your Answer"), E("input",{className:"inp",placeholder:"Answer (case insensitive)",value:form.secA,onChange:e=>sf("secA",e.target.value)}))
        ),
        err && E("p",{style:{color:"#f87171",fontSize:"0.75rem",textAlign:"center",marginBottom:"8px"}},err),
        ok  && E("p",{style:{color:"#4ade80",fontSize:"0.75rem",textAlign:"center",marginBottom:"8px"}},ok),
        E("button",{className:"btn-primary",onClick:handleAuth,disabled:loading}, loading?"Loading...":mode==="login"?"Login â†’":"Create Account â†’"),
        mode==="login" && E("div",{style:{textAlign:"center",marginTop:"8px"}},
          E("button",{onClick:()=>{setMode("recover");setErr("");setOk("");},style:{color:"#818cf8",fontSize:"0.75rem",textDecoration:"underline",background:"none",border:"none",cursor:"pointer"}},"Forgot password?")
        )
      ),
      mode==="recover" && E(React.Fragment, null,
        E("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"}},
          E("button",{onClick:()=>{setMode("login");setErr("");setOk("");},style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer",fontSize:"1.2rem"}},"â†"),
          E("span",{style:{color:"#fff",fontWeight:600,fontSize:"0.875rem"}},"Password Recovery")
        ),
        E("div",{style:{display:"flex",gap:"4px",marginBottom:"12px"}},
          [1,2,3].map(s=>E("div",{key:s,style:{flex:1,height:"4px",borderRadius:"9999px",background:rec.step>=s?"#6366f1":"#334155"}}))
        ),
        rec.step===1 && E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Username"), E("input",{className:"inp",placeholder:"your username",value:rec.username,onChange:e=>sr("username",e.target.value)})),
        rec.step===2 && E(React.Fragment,null,
          E("div",{style:{background:"#334155",borderRadius:"8px",padding:"12px",marginBottom:"12px"}}, E("p",{style:{color:"#e2e8f0",fontSize:"0.75rem",fontWeight:500}},rec.question)),
          E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Your Answer"), E("input",{className:"inp",placeholder:"Answer",value:rec.answer,onChange:e=>sr("answer",e.target.value)}))
        ),
        rec.step===3 && E(React.Fragment,null,
          E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"New Password"), E("input",{type:"password",className:"inp",placeholder:"min. 4 characters",value:rec.newPass,onChange:e=>sr("newPass",e.target.value)})),
          E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Confirm Password"), E("input",{type:"password",className:"inp",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",value:rec.confirm,onChange:e=>sr("confirm",e.target.value)}))
        ),
        err && E("p",{style:{color:"#f87171",fontSize:"0.75rem",textAlign:"center",marginBottom:"8px"}},err),
        ok  && E("p",{style:{color:"#4ade80",fontSize:"0.75rem",textAlign:"center",marginBottom:"8px"}},ok),
        E("button",{className:"btn-primary",onClick:handleRecover,disabled:loading}, loading?"Loading...":rec.step===3?"Reset Password âœ“":"Next â†’")
      )
    )
  );
}

// â”€â”€ ChangePasswordModal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ChangePasswordModal({ token, onClose }) {
  const [form, setForm] = useState({ current:"", newPass:"", confirm:"" });
  const [err, setErr] = useState(""); const [ok, setOk] = useState(""); const [loading, setLoading] = useState(false);
  const E = React.createElement;
  const handle = async () => {
    setErr(""); setOk(""); setLoading(true);
    try {
      if (!form.current||!form.newPass||!form.confirm) throw new Error("Fill all fields.");
      if (form.newPass.length<4) throw new Error("Min. 4 characters.");
      if (form.newPass!==form.confirm) throw new Error("Passwords don't match.");
      await API("POST", "/change-password", { currentPassword:form.current, newPassword:form.newPass }, token);
      setOk("Password changed!"); setTimeout(onClose, 1500);
    } catch(e) { setErr(e.message); } finally { setLoading(false); }
  };
  return E("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"}},
    E("div",{className:"card",style:{width:"100%",maxWidth:"384px"}},
      E("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"}},
        E("span",{style:{color:"#fff",fontWeight:600}},"ðŸ”‘ Change Password"),
        E("button",{onClick:onClose,style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer",fontSize:"1.5rem"}},"Ã—")
      ),
      E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Current Password"), E("input",{type:"password",className:"inp",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",value:form.current,onChange:e=>setForm(f=>({...f,current:e.target.value}))})),
      E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"New Password"), E("input",{type:"password",className:"inp",placeholder:"min. 4 characters",value:form.newPass,onChange:e=>setForm(f=>({...f,newPass:e.target.value}))})),
      E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Confirm New Password"), E("input",{type:"password",className:"inp",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",value:form.confirm,onChange:e=>setForm(f=>({...f,confirm:e.target.value}))})),
      err && E("p",{style:{color:"#f87171",fontSize:"0.75rem",textAlign:"center",marginBottom:"8px"}},err),
      ok  && E("p",{style:{color:"#4ade80",fontSize:"0.75rem",textAlign:"center",marginBottom:"8px"}},ok),
      E("button",{className:"btn-primary",onClick:handle,disabled:loading}, loading?"Saving...":"Save Changes")
    )
  );
}

// â”€â”€ AdminResetModal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AdminResetModal({ username, token, onClose }) {
  const [form, setForm] = useState({ newPass:"", confirm:"" });
  const [err, setErr] = useState(""); const [ok, setOk] = useState(""); const [loading, setLoading] = useState(false);
  const E = React.createElement;
  const handle = async () => {
    setErr(""); setOk(""); setLoading(true);
    try {
      if (form.newPass.length<4) throw new Error("Min. 4 characters.");
      if (form.newPass!==form.confirm) throw new Error("Passwords don't match.");
      await API("POST", "/admin/reset-password", { username, newPassword:form.newPass }, token);
      setOk("Password reset!"); setTimeout(onClose, 1500);
    } catch(e) { setErr(e.message); } finally { setLoading(false); }
  };
  return E("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"}},
    E("div",{className:"card",style:{width:"100%",maxWidth:"384px"}},
      E("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"}},
        E("span",{style:{color:"#fff",fontWeight:600}},"ðŸ”‘ Reset â€” @"+username),
        E("button",{onClick:onClose,style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer",fontSize:"1.5rem"}},"Ã—")
      ),
      E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"New Password"), E("input",{type:"password",className:"inp",placeholder:"min. 4 characters",value:form.newPass,onChange:e=>setForm(f=>({...f,newPass:e.target.value}))})),
      E("div",{style:{marginBottom:"12px"}}, E("label",{className:"lbl"},"Confirm Password"), E("input",{type:"password",className:"inp",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",value:form.confirm,onChange:e=>setForm(f=>({...f,confirm:e.target.value}))})),
      err && E("p",{style:{color:"#f87171",fontSize:"0.75rem",textAlign:"center",marginBottom:"8px"}},err),
      ok  && E("p",{style:{color:"#4ade80",fontSize:"0.75rem",textAlign:"center",marginBottom:"8px"}},ok),
      E("button",{onClick:handle,disabled:loading,style:{width:"100%",padding:"10px",borderRadius:"12px",fontWeight:700,color:"#fff",border:"none",cursor:"pointer",background:"linear-gradient(to right,#dc2626,#ea580c)"}}, loading?"Resetting...":"Reset Password")
    )
  );
}

// â”€â”€ StudentApp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function StudentApp({ user }) {
  const [entries, setEntries] = useState([]);
  const [tab,     setTab]     = useState("log");
  const [form,    setForm]    = useState({ date:new Date().toISOString().split("T")[0], bedTime:"23:00", wakeTime:"07:00", screenTime:1, energy:7, notes:"" });
  const [saved,   setSaved]   = useState(false);
  const [showPw,  setShowPw]  = useState(false);
  const [loading, setLoading] = useState(true);
  const E = React.createElement;

  const loadEntries = useCallback(async () => {
    try { const data = await API("GET", "/entries", null, user.token); setEntries(data); } catch(e) { console.error(e); }
    setLoading(false);
  }, [user.token]);

  useEffect(() => { loadEntries(); }, [loadEntries]);

  const handleSave = async () => {
    const duration = calcDur(form.bedTime, form.wakeTime);
    try {
      await API("POST", "/entries", {...form, duration}, user.token);
      setSaved(true); setTimeout(()=>setSaved(false), 2000);
      loadEntries();
    } catch(e) { alert(e.message); }
  };

  const del = async id => {
    try { await API("DELETE", "/entries/"+id, null, user.token); loadEntries(); } catch(e) { alert(e.message); }
  };

  const weekly    = entries.slice(0,7).reverse();
  const chartData = weekly.map(e => ({ name:fmt(e.date), Sleep:e.duration, Screen:e.screen_time, Energy:e.energy }));
  const TABS = [["log","ðŸ“ Log"],["history","ðŸ“… History"],["charts","ðŸ“Š Charts"],["insights","ðŸ’¡ Insights"],["tips","ðŸŒ¿ Tips"]];

  return E("div", { style:{minHeight:"100vh",background:"#0f172a"} },
    showPw && E(ChangePasswordModal, { token:user.token, onClose:()=>setShowPw(false) }),
    E("div", { className:"grad-header", style:{padding:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"} },
      E("div", null,
        E("div", {style:{fontSize:"1.25rem",fontWeight:700,color:"#fff"}}, "ðŸŒ™ Sleep Diary"),
        E("div", {style:{color:"#94a3b8",fontSize:"0.75rem"}}, "@"+user.username)
      ),
      E("div", {style:{display:"flex",gap:"8px"}},
        E("button", {className:"btn-outline",onClick:()=>setShowPw(true)}, "ðŸ”‘ Password"),
        E("button", {className:"btn-outline",onClick:user.logout}, "Logout")
      )
    ),
    E("div", {style:{display:"flex",borderBottom:"1px solid #334155",background:"#0f172a",overflowX:"auto"}},
      TABS.map(([k,l]) => E("button", {key:k, className:"tab-btn"+(tab===k?" active":""), onClick:()=>setTab(k)}, l))
    ),
    E("div", {style:{padding:"16px",maxWidth:"672px",margin:"0 auto"}},
      loading && E("div", {className:"spinner"}),
      !loading && E(React.Fragment, null,

        tab==="log" && E("div", {className:"space-y-4"},
          E("h2",{style:{color:"#a5b4fc",fontWeight:600}}, "Today's Sleep Log"),
          E("div",null, E("label",{className:"lbl"},"ðŸ“… Date"), E("input",{type:"date",className:"inp",value:form.date,onChange:e=>setForm({...form,date:e.target.value})})),
          E("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"}},
            E("div",null, E("label",{className:"lbl"},"ðŸ›ï¸ Bedtime"), E("input",{type:"time",className:"inp",value:form.bedTime,onChange:e=>setForm({...form,bedTime:e.target.value})})),
            E("div",null, E("label",{className:"lbl"},"â° Wake-up"), E("input",{type:"time",className:"inp",value:form.wakeTime,onChange:e=>setForm({...form,wakeTime:e.target.value})}))
          ),
          E("div",{style:{background:"#1e293b",borderRadius:"8px",padding:"12px",textAlign:"center"}},
            E("span",{style:{color:"#94a3b8"}}, "Duration: "),
            E("span",{style:{color:"#a5b4fc",fontWeight:700,fontSize:"1.25rem"}}, calcDur(form.bedTime,form.wakeTime)+"h")
          ),
          E("div",null,
            E("label",{className:"lbl"}, "ðŸ“± Pre-sleep screen time: ", E("span",{style:{color:"#a5b4fc",fontWeight:700}}, form.screenTime+"h")),
            E("input",{type:"range",min:0,max:6,step:0.5,value:form.screenTime,className:"accent-indigo",onChange:e=>setForm({...form,screenTime:+e.target.value})}),
            E("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"#64748b",marginTop:"4px"}}, E("span",null,"0h"), E("span",null,"3h"), E("span",null,"6h"))
          ),
          E("div",null,
            E("label",{className:"lbl"}, "âš¡ Morning energy: ", E("span",{style:{color:"#facc15",fontWeight:700}}, form.energy+"/10")),
            E("input",{type:"range",min:1,max:10,step:1,value:form.energy,className:"accent-yellow",onChange:e=>setForm({...form,energy:+e.target.value})}),
            E("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"#64748b",marginTop:"4px"}}, E("span",null,"ðŸ˜´ 1"), E("span",null,"ðŸ˜ 5"), E("span",null,"âš¡ 10"))
          ),
          E("div",null, E("label",{className:"lbl"},"ðŸ“ Notes"), E("textarea",{className:"inp",placeholder:"How did you sleep?",value:form.notes,onChange:e=>setForm({...form,notes:e.target.value}),style:{resize:"none",height:"64px"}})),
          E("button",{className:"btn-primary",onClick:handleSave}, saved?"âœ… Saved!":"ðŸ’¾ Save Entry")
        ),

        tab==="history" && E("div", {className:"space-y-3"},
          E("h2",{style:{color:"#a5b4fc",fontWeight:600}}, "Weekly History"),
          entries.length===0 && E("p",{style:{color:"#94a3b8",textAlign:"center",padding:"32px 0"}}, "No entries yet. Start logging! ðŸŒ™"),
          entries.slice(0,7).map(e => E("div",{key:e.id,className:"card"},
            E("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}},
              E("div",null,
                E("p",{style:{fontWeight:600,color:"#fff",fontSize:"0.875rem"}}, fmt(e.date)),
                E("p",{style:{color:"#94a3b8",fontSize:"0.75rem",marginTop:"2px"}}, e.bed_time+" â†’ "+e.wake_time)
              ),
              E("button",{onClick:()=>del(e.id),style:{background:"none",border:"none",color:"#475569",cursor:"pointer",fontSize:"1rem"}}, "ðŸ—‘")
            ),
            E("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px",marginTop:"12px"}},
              E("div",{className:"mini-card"}, E("div",{style:{color:"#a5b4fc",fontWeight:700,fontSize:"0.875rem"}},e.duration+"h"), E("div",{style:{color:"#94a3b8",fontSize:"0.75rem"}},"Sleep")),
              E("div",{className:"mini-card"}, E("div",{style:{color:"#d8b4fe",fontWeight:700,fontSize:"0.875rem"}},e.screen_time+"h"), E("div",{style:{color:"#94a3b8",fontSize:"0.75rem"}},"Screen")),
              E("div",{className:"mini-card"}, E("div",{style:{color:"#fde047",fontWeight:700,fontSize:"0.875rem"}},e.energy+"/10"), E("div",{style:{color:"#94a3b8",fontSize:"0.75rem"}},"Energy"))
            ),
            e.notes && E("p",{style:{color:"#94a3b8",fontSize:"0.75rem",marginTop:"8px",fontStyle:"italic"}}, '"'+e.notes+'"')
          ))
        ),

        tab==="charts" && E("div", {className:"space-y-5"},
          E("h2",{style:{color:"#a5b4fc",fontWeight:600}}, "Weekly Charts"),
          chartData.length<2 && E("p",{style:{color:"#94a3b8",textAlign:"center",padding:"32px 0"}}, "Log at least 2 days! ðŸ“Š"),
          chartData.length>=2 && E(React.Fragment, null,
            E("div",{className:"card"},
              E("h3",{style:{color:"#cbd5e1",fontSize:"0.75rem",fontWeight:600,marginBottom:"12px"}}, "Sleep Duration (hours)"),
              E(ResponsiveContainer,{width:"100%",height:160},
                E(BarChart,{data:chartData},
                  E(CartesianGrid,{strokeDasharray:"3 3",stroke:"#334155"}),
                  E(XAxis,{dataKey:"name",tick:{fill:"#94a3b8",fontSize:9}}),
                  E(YAxis,{tick:{fill:"#94a3b8",fontSize:9},domain:[0,12]}),
                  E(Tooltip,{contentStyle:{background:"#1e293b",border:"none",borderRadius:8,fontSize:11}}),
                  E(Bar,{dataKey:"Sleep",fill:"#6366f1",radius:[4,4,0,0]})
                )
              )
            ),
            E("div",{className:"card"},
              E("h3",{style:{color:"#cbd5e1",fontSize:"0.75rem",fontWeight:600,marginBottom:"12px"}}, "Screen Time vs Energy"),
              E(ResponsiveContainer,{width:"100%",height:160},
                E(LineChart,{data:chartData},
                  E(CartesianGrid,{strokeDasharray:"3 3",stroke:"#334155"}),
                  E(XAxis,{dataKey:"name",tick:{fill:"#94a3b8",fontSize:9}}),
                  E(YAxis,{tick:{fill:"#94a3b8",fontSize:9}}),
                  E(Tooltip,{contentStyle:{background:"#1e293b",border:"none",borderRadius:8,fontSize:11}}),
                  E(Legend,{wrapperStyle:{fontSize:10}}),
                  E(Line,{type:"monotone",dataKey:"Screen",stroke:"#a78bfa",strokeWidth:2,dot:{r:3},name:"Screen (h)"}),
                  E(Line,{type:"monotone",dataKey:"Energy",stroke:"#fbbf24",strokeWidth:2,dot:{r:3},name:"Energy (/10)"})
                )
              )
            )
          )
        ),

        tab==="insights" && E("div", {className:"space-y-3"},
          E("h2",{style:{color:"#a5b4fc",fontWeight:600}}, "Automatic Insights"),
          genInsights(entries).map((msg,i) => E("div",{key:i,className:"card"}, E("p",{style:{color:"#e2e8f0",fontSize:"0.875rem",lineHeight:1.625}},msg)))
        ),

        tab==="tips" && E("div", {className:"space-y-3"},
          E("h2",{style:{color:"#a5b4fc",fontWeight:600}}, "Sleep Hygiene Tips"),
          TIPS.map((t,i) => E("div",{key:i,className:"card",style:{display:"flex",gap:"12px"}},
            E("span",{style:{fontSize:"1.5rem"}}, t.icon),
            E("div",null,
              E("h3",{style:{color:"#fff",fontWeight:600,fontSize:"0.875rem"}}, t.title),
              E("p",{style:{color:"#94a3b8",fontSize:"0.75rem",marginTop:"4px",lineHeight:1.625}}, t.text)
            )
          ))
        )
      )
    )
  );
}

// â”€â”€ AdminApp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AdminApp({ user }) {
  const [data,      setData]      = useState([]);
  const [tab,       setTab]       = useState("overview");
  const [loading,   setLoading]   = useState(true);
  const [resetUser, setResetUser] = useState(null);
  const E = React.createElement;

  const loadData = useCallback(async () => {
    setLoading(true);
    try { const d = await API("GET", "/admin/users", null, user.token); setData(d); } catch(e) { console.error(e); }
    setLoading(false);
  }, [user.token]);

  useEffect(() => { loadData(); }, [loadData]);

  const allEntries = data.flatMap(u => u.entries);
  const rankings   = data.filter(u=>u.entries.length>0).map(u => ({
    name: u.username,
    avgSleep:  avg(u.entries.map(e=>e.duration)),
    avgEnergy: avg(u.entries.map(e=>e.energy)),
    avgScreen: avg(u.entries.map(e=>e.screen_time)),
    count: u.entries.length,
  }));
  const groupChart = rankings.map(r => ({ name:r.name, Sleep:r.avgSleep, Energy:r.avgEnergy, Screen:r.avgScreen }));
  const medal = i => ["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"][i] || (i+1)+".";
  const TABS = [["overview","ðŸ“Š Overview"],["rankings","ðŸ† Rankings"],["compare","ðŸ‘¥ Compare"],["students","ðŸ“‹ Students"]];

  return E("div", {style:{minHeight:"100vh",background:"#0f172a"}},
    resetUser && E(AdminResetModal, {username:resetUser, token:user.token, onClose:()=>{setResetUser(null);loadData();}}),
    E("div",{className:"grad-admin",style:{padding:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"}},
      E("div",null,
        E("div",{style:{fontSize:"1.25rem",fontWeight:700,color:"#fff"}}, "ðŸ›¡ï¸ Admin Panel"),
        E("div",{style:{color:"#94a3b8",fontSize:"0.75rem"}}, data.length+" students registered")
      ),
      E("button",{className:"btn-outline",onClick:user.logout}, "Logout")
    ),
    E("div",{style:{display:"flex",borderBottom:"1px solid #334155",background:"#0f172a",overflowX:"auto"}},
      TABS.map(([k,l]) => E("button",{key:k,className:"tab-btn"+(tab===k?" active":""),onClick:()=>setTab(k)},l))
    ),
    E("div",{style:{padding:"16px",maxWidth:"672px",margin:"0 auto"}},
      loading && E("div",{className:"spinner"}),
      !loading && E(React.Fragment, null,

        tab==="overview" && E("div",{className:"space-y-4"},
          E("h2",{style:{color:"#a5b4fc",fontWeight:600}}, "Group Overview"),
          allEntries.length===0 && E("p",{style:{color:"#94a3b8",textAlign:"center",padding:"32px 0"}}, "No student data yet."),
          allEntries.length>0 && E(React.Fragment, null,
            E("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"}},
              [
                {label:"Avg Sleep",  val:avg(allEntries.map(e=>e.duration))+"h",    icon:"ðŸ›ï¸", color:"#a5b4fc"},
                {label:"Avg Energy", val:avg(allEntries.map(e=>e.energy))+"/10",    icon:"âš¡",  color:"#facc15"},
                {label:"Avg Screen", val:avg(allEntries.map(e=>e.screen_time))+"h", icon:"ðŸ“±",  color:"#d8b4fe"},
                {label:"Total Logs", val:allEntries.length,                          icon:"ðŸ“",  color:"#86efac"},
              ].map((s,i) => E("div",{key:i,className:"stat-card"},
                E("div",{style:{fontSize:"1.5rem",marginBottom:"4px"}}, s.icon),
                E("div",{style:{fontSize:"1.25rem",fontWeight:700,color:s.color}}, s.val),
                E("div",{style:{color:"#94a3b8",fontSize:"0.75rem",marginTop:"4px"}}, s.label)
              ))
            ),
            groupChart.length>=2 && E("div",{className:"card"},
              E("h3",{style:{color:"#cbd5e1",fontSize:"0.75rem",fontWeight:600,marginBottom:"12px"}}, "Student Averages"),
              E(ResponsiveContainer,{width:"100%",height:200},
                E(BarChart,{data:groupChart,layout:"vertical"},
                  E(CartesianGrid,{strokeDasharray:"3 3",stroke:"#334155"}),
                  E(XAxis,{type:"number",tick:{fill:"#94a3b8",fontSize:9}}),
                  E(YAxis,{type:"category",dataKey:"name",tick:{fill:"#94a3b8",fontSize:9},width:60}),
                  E(Tooltip,{contentStyle:{background:"#1e293b",border:"none",borderRadius:8,fontSize:11}}),
                  E(Legend,{wrapperStyle:{fontSize:10}}),
                  E(Bar,{dataKey:"Sleep",  fill:"#6366f1",name:"Sleep (h)",    radius:[0,4,4,0]}),
                  E(Bar,{dataKey:"Energy", fill:"#fbbf24",name:"Energy (/10)", radius:[0,4,4,0]}),
                  E(Bar,{dataKey:"Screen", fill:"#a78bfa",name:"Screen (h)",   radius:[0,4,4,0]})
                )
              )
            )
          )
        ),

        tab==="rankings" && E("div",{className:"space-y-4"},
          E("h2",{style:{color:"#a5b4fc",fontWeight:600}}, "ðŸ† Rankings"),
          rankings.length===0 && E("p",{style:{color:"#94a3b8",textAlign:"center",padding:"32px 0"}}, "No data yet."),
          [
            {title:"Most Sleep ðŸ˜´",    key:"avgSleep",  unit:"h avg",   sort:(a,b)=>b.avgSleep-a.avgSleep,   color:"#a5b4fc"},
            {title:"Best Energy âš¡",   key:"avgEnergy", unit:"/10 avg", sort:(a,b)=>b.avgEnergy-a.avgEnergy, color:"#facc15"},
            {title:"Least Screen ðŸ“µ",  key:"avgScreen", unit:"h avg",   sort:(a,b)=>a.avgScreen-b.avgScreen, color:"#d8b4fe"},
            {title:"Most Consistent ðŸ“…",key:"count",    unit:"logs",    sort:(a,b)=>b.count-a.count,         color:"#86efac"},
          ].map((r,ri) => E("div",{key:ri,className:"card"},
            E("h3",{style:{color:"#fff",fontWeight:600,fontSize:"0.875rem",marginBottom:"12px"}}, r.title),
            E("div",{className:"space-y-2"},
              [...rankings].sort(r.sort).slice(0,5).map((u,i) =>
                E("div",{key:u.name,style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
                  E("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},
                    E("span",{style:{fontSize:"1rem"}}, medal(i)),
                    E("span",{style:{color:"#e2e8f0",fontSize:"0.875rem"}}, "@"+u.name)
                  ),
                  E("span",{style:{color:r.color,fontWeight:700,fontSize:"0.875rem"}}, u[r.key]+" "+r.unit)
                )
              )
            )
          ))
        ),

        tab==="compare" && E("div",{className:"space-y-4"},
          E("h2",{style:{color:"#a5b4fc",fontWeight:600}}, "ðŸ‘¥ Collective Charts"),
          groupChart.length<2 && E("p",{style:{color:"#94a3b8",textAlign:"center",padding:"32px 0"}}, "Need at least 2 students with data."),
          groupChart.length>=2 && E(React.Fragment, null,
            E("div",{className:"card"},
              E("h3",{style:{color:"#cbd5e1",fontSize:"0.75rem",fontWeight:600,marginBottom:"12px"}}, "Sleep per Student"),
              E(ResponsiveContainer,{width:"100%",height:180},
                E(BarChart,{data:groupChart},
                  E(CartesianGrid,{strokeDasharray:"3 3",stroke:"#334155"}),
                  E(XAxis,{dataKey:"name",tick:{fill:"#94a3b8",fontSize:9}}),
                  E(YAxis,{tick:{fill:"#94a3b8",fontSize:9},domain:[0,12]}),
                  E(Tooltip,{contentStyle:{background:"#1e293b",border:"none",borderRadius:8,fontSize:11}}),
                  E(Bar,{dataKey:"Sleep",fill:"#6366f1",radius:[4,4,0,0],name:"Avg Sleep (h)"})
                )
              )
            ),
            E("div",{className:"card"},
              E("h3",{style:{color:"#cbd5e1",fontSize:"0.75rem",fontWeight:600,marginBottom:"12px"}}, "Energy vs Screen"),
              E(ResponsiveContainer,{width:"100%",height:180},
                E(BarChart,{data:groupChart},
                  E(CartesianGrid,{strokeDasharray:"3 3",stroke:"#334155"}),
                  E(XAxis,{dataKey:"name",tick:{fill:"#94a3b8",fontSize:9}}),
                  E(YAxis,{tick:{fill:"#94a3b8",fontSize:9}}),
                  E(Tooltip,{contentStyle:{background:"#1e293b",border:"none",borderRadius:8,fontSize:11}}),
                  E(Legend,{wrapperStyle:{fontSize:10}}),
                  E(Bar,{dataKey:"Energy",fill:"#fbbf24",radius:[4,4,0,0],name:"Energy (/10)"}),
                  E(Bar,{dataKey:"Screen",fill:"#a78bfa",radius:[4,4,0,0],name:"Screen (h)"})
                )
              )
            ),
            E("div",{className:"card"},
              E("h3",{style:{color:"#cbd5e1",fontSize:"0.75rem",fontWeight:600,marginBottom:"12px"}}, "Radar â€” Student Profiles"),
              E(ResponsiveContainer,{width:"100%",height:220},
                E(RadarChart,{data:groupChart},
                  E(PolarGrid,{stroke:"#334155"}),
                  E(PolarAngleAxis,{dataKey:"name",tick:{fill:"#94a3b8",fontSize:9}}),
                  E(Radar,{name:"Sleep",  dataKey:"Sleep",  stroke:"#6366f1",fill:"#6366f1",fillOpacity:0.3}),
                  E(Radar,{name:"Energy", dataKey:"Energy", stroke:"#fbbf24",fill:"#fbbf24",fillOpacity:0.3}),
                  E(Legend,{wrapperStyle:{fontSize:10}})
                )
              )
            )
          )
        ),

        tab==="students" && E("div",{className:"space-y-3"},
          E("h2",{style:{color:"#a5b4fc",fontWeight:600}}, "ðŸ“‹ All Students"),
          data.length===0 && E("p",{style:{color:"#94a3b8",textAlign:"center",padding:"32px 0"}}, "No students registered yet."),
          data.map(u => E("div",{key:u.id,className:"card"},
            E("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},
              E("span",{style:{color:"#fff",fontWeight:600}}, "@"+u.username),
              E("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},
                E("span",{style:{color:"#94a3b8",fontSize:"0.75rem"}}, u.entries.length+" log"+(u.entries.length!==1?"s":"")),
                E("button",{onClick:()=>setResetUser(u.username),style:{fontSize:"0.75rem",color:"#fb923c",border:"1px solid #9a3412",background:"none",borderRadius:"4px",padding:"2px 8px",cursor:"pointer"}}, "ðŸ”‘ Reset PW")
              )
            ),
            u.entries.length>0
              ? E("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}},
                  E("div",{className:"mini-card"}, E("div",{style:{color:"#a5b4fc",fontWeight:700,fontSize:"0.875rem"}},avg(u.entries.map(e=>e.duration))+"h"), E("div",{style:{color:"#94a3b8",fontSize:"0.75rem"}},"Avg Sleep")),
                  E("div",{className:"mini-card"}, E("div",{style:{color:"#facc15",fontWeight:700,fontSize:"0.875rem"}},avg(u.entries.map(e=>e.energy))+"/10"), E("div",{style:{color:"#94a3b8",fontSize:"0.75rem"}},"Avg Energy")),
                  E("div",{className:"mini-card"}, E("div",{style:{color:"#d8b4fe",fontWeight:700,fontSize:"0.875rem"}},avg(u.entries.map(e=>e.screen_time))+"h"), E("div",{style:{color:"#94a3b8",fontSize:"0.75rem"}},"Avg Screen"))
                )
              : E("p",{style:{color:"#64748b",fontSize:"0.75rem"}}, "No entries yet.")
          ))
        )
      )
    )
  );
}

// â”€â”€ Main App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const [user, setUser] = useState(() => {
    const t = localStorage.getItem("sd_token");
    const u = localStorage.getItem("sd_user");
    return t && u ? {...JSON.parse(u), token:t} : null;
  });

  const logout = () => {
    localStorage.removeItem("sd_token");
    localStorage.removeItem("sd_user");
    setUser(null);
  };

  if (!user) return React.createElement(AuthScreen, { onLogin: data => setUser(data) });
  const u = {...user, logout};
  if (user.isAdmin) return React.createElement(AdminApp,    { user:u });
  return React.createElement(StudentApp, { user:u });
}

const Footer = () => React.createElement("div", { className:"footer" }, "Desenvolvido por: JosÃ© Paulo Tavares");

const _AuthScreen = AuthScreen;
AuthScreen = (props) => React.createElement(React.Fragment, null, React.createElement(_AuthScreen, props), React.createElement(Footer));

const _StudentApp = StudentApp;
StudentApp = (props) => React.createElement(React.Fragment, null, React.createElement(_StudentApp, props), React.createElement(Footer));

const _AdminApp = AdminApp;
AdminApp = (props) => React.createElement(React.Fragment, null, React.createElement(_AdminApp, props), React.createElement(Footer));

ReactDOM.render(React.createElement(App), document.getElementById("root"));
</script>
</body>
</html>
